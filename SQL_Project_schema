--Drop all tables if they exist
DROP TABLE "ACCIDENT";
DROP TABLE "ADDRESS";
DROP TABLE "AGENT";
DROP TABLE "AGENT_HAS_CUSTOMER";
DROP TABLE "AUTO_POLICY";
DROP TABLE "CAR";
DROP TABLE "COVERS_CAR";
DROP TABLE "COVERS_PROPERTY";
DROP TABLE "CURRENCY";
DROP TABLE "CUSTOMER";
DROP TABLE "HAD_ACCIDENT";
DROP TABLE "LIVES_IN";
DROP TABLE "METHOD_OF_PAYMENT";
DROP TABLE "PAYMENT";
DROP TABLE "POLICY";
DROP TABLE "POLICY_HOLDER";
DROP TABLE "POLICY_PAYMENT";
DROP TABLE "PROPERTY";
DROP TABLE "PROPERTY_POLICY";
DROP TABLE "WAS_IN_ACCIDENT";
DROP TABLE "WORKPLACE";

--create accident table
CREATE TABLE "ACCIDENT"(
       "ACCIDENT_ID" INTEGER,
       "REPORT_NUM" INTEGER CONSTRAINT "ACC_REPNUM_NN" NOT NULL ENABLE,
       "ACC_DATE" DATE CONSTRAINT "ACC_ACDATE_NN" NOT NULL ENABLE,
       "ACC_LOCATION" VARCHAR2(30) CONSTRAINT "ACC_ACLOC_NN" NOT NULL ENABLE,
        CONSTRAINT "ACC_ACCID_PK" PRIMARY KEY ("ACCIDENT_ID")
    USING INDEX ENABLE
);

--create address table
CREATE TABLE "ADDRESS"(
       "ADD_ID" INTEGER,
       "STREET_ADDRESS" VARCHAR2(50) CONSTRAINT "ADD_STRADD_NN" NOT NULL ENABLE,
       "STATE" VARCHAR2(20) CONSTRAINT "ADD_STATE_NN" NOT NULL ENABLE,
       "CITY" VARCHAR2(20) CONSTRAINT "ADD_CITY_NN" NOT NULL ENABLE,
       "ZIP_CODE" VARCHAR2(10) CONSTRAINT "ADD_ZPCODE_NN" NOT NULL ENABLE,
       CONSTRAINT "ADS_ADDID_PK" PRIMARY KEY("ADD_ID")
    USING INDEX ENABLE
);

--create agent table
CREATE TABLE "AGENT" (
    "AGENT_ID" INTEGER,
    "FIRST_NAME" VARCHAR2(30) CONSTRAINT "AG_FSTNAME_NN" NOT NULL ENABLE,
    "LAST_NAME" VARCHAR2(30) CONSTRAINT "AG_LNAME_NN" NOT NULL ENABLE,
    "USER_NAME" VARCHAR2(20) CONSTRAINT "AG_USNAME_NN" NOT NULL ENABLE,
    "PHONE" VARCHAR2(11) CONSTRAINT "AG_PHONE_NN" NOT NULL ENABLE,
     CONSTRAINT "AG_USERNAME_UK" UNIQUE ("USER_NAME"),
     CONSTRAINT "AG_PHONE_UK" UNIQUE ("PHONE")
  USING INDEX ENABLE,
     CONSTRAINT "AG_ID_PK" PRIMARY KEY ("AGENT_ID")
  USING INDEX ENABLE
);

--create agent_has_customer table
CREATE TABLE "AGENT_HAS_CUSTOMER" (
       "CUSTOMER_AGENT" INTEGER,
       "AGENT_ID" INTEGER,
       "CUSTOMER_ID" INTEGER,
        CONSTRAINT "AHC_CUSTOMERAG_PK" PRIMARY KEY("CUSTOMER_AGENT","AGENT_ID","CUSTOMER_ID")
     USING INDEX ENABLE
);

--Add FK constraints
  ALTER TABLE "AGENT_HAS_CUSTOMER" ADD CONSTRAINT "AHC_AGENTID_FK1" FOREIGN KEY ("AGENT_ID") 
        REFERENCES "AGENT" ("AGENT_ID") ENABLE;
  ALTER TABLE "AGENT_HAS_CUSTOMER" ADD CONSTRAINT "AHC_CUSTID_FK2" FOREIGN KEY ("CUSTOMER_ID") 
        REFERENCES "CUSTOMER" ("CUSTOMER_ID) ENABLE;

--create auto_policy table
CREATE TABLE "AUTO_POLICY" (
       "AP_ID" INTEGER,
       "POLICY_ID" INTEGER,
       "NUM" INTEGER CONSTRAINT "AP_NUM_NN" NOT NULL ENABLE,
        CONSTRAINT "AP_APID_PK" PRIMARY KEY ("AP_ID","POLICY_ID")
     USING INDEX ENABLE
);

--Add FK constraints
  ALTER TABLE "AUTO_POLICY" ADD CONSTRAINT "AP_POLID_FK1" FOREIGN KEY ("POLICY_ID")
        REFERENCES "POLICY" ("POLICY_ID") ENABLE;

--create car table
CREATE TABLE "CAR"(
       "CAR_ID" INTEGER,
       "MODEL" VARCHAR2(10) CONSTRAINT "CAR_MOD_NN" NOT NULL ENABLE,
       "PLATE" VARCHAR2(7) CONSTRAINT "CAR_PLT_NN" NOT NULL ENABLE,
       "COLOUR" VARCHAR2(15) CONSTRAINT "CAR_COL_NN" NOT NULL ENABLE,
       "YEAR" NUMBER(4) CONSTRAINT "CAR_YR_NN" NOT NULL ENABLE,
       "DOORS" NUMBER(1) CONSTRAINT "CAR_DR_NN" NOT NULL ENABLE,
        CONSTRAINT "CAR_CARID_PK" PRIMARY KEY ("CAR_ID")
    USING INDEX ENABLE
);

--create covers_car table
CREATE TABLE "COVERS_CAR" (
       "COVERSCAR_ID" INTEGER,
       "POLICY_ID" INTEGER,
       "CAR_ID" INTEGER,
       "COVER_COST" NUMBER(6,2) CONSTRAINT "CC_COVCST_NN" NOT NULL ENABLE,
        CONSTRAINT "CC_COVCAR_PK" PRIMARY KEY ("COVERSCAR_ID","POLICY_ID","CAR_ID")
     USING INDEX ENABLE
);

--Add FK constraints
  ALTER TABLE "COVERS_CAR" ADD CONSTRAINT "CC_POLID_FK1" FOREIGN KEY ("POLICY_ID")
        REFERENCES "POLICY" ("POLICY_ID") ENABLE;
  ALTER TABLE "COVERS_CAR" ADD CONSTRAINT "CC_CARID_FK2" FOREIGN KEY ("CAR_ID")
        REFERENCES "CAR" ("CAR_ID") ENABLE;

--create covers_property table
CREATE TABLE "COVERS_PROPERTY" (
	"COVERSPROPERTY_ID" INTEGER,
	"POLICY_ID" INTEGER,
	"PROPERTY_ID" INTEGER,
        "PROP_COST" INTEGER CONSTRAINT "CVPPT_PROPCOST_NN" NOT NULL ENABLE,
	CONSTRAINT "CVPPT_CVPPTID_PK" PRIMARY KEY ( "COVERSPROPERTY_ID","POLICY_ID","PROPERTY_ID")
	USING INDEX ENABLE
);

--Add FK constraints
  ALTER TABLE "COVERS_PROPERTY" ADD CONSTRAINT "CVPPT_POLID_FK1" FOREIGN KEY ("POLICY_ID")
            REFERENCES "POLICY" ("POLICY_ID") ENABLE;
  ALTER TABLE "AGENT_HAS_CUSTOMER" ADD CONSTRAINT "CVPPT_PPTID_FK2" FOREIGN KEY ("PROPERTY_ID")
            REFERENCES "CUSTOMER" ("PROPERTY_ID") ENABLE;

--create currency table
CREATE TABLE "CURRENCY" (
	"CURRENCY_ID" INTEGER,
	"LOCAL" VARCHAR2(10) CONSTRAINT "CRR_LOCAL_NN" NOT NULL ENABLE,
	"FOREIGN" VARCHAR2(10) CONSTRAINT "CRR_FOREIGN_NN" NOT NULL ENABLE,
	CONSTRAINT "CRR_CRID_PK" PRIMARY KEY ("CURRENCY_ID")
USING INDEX ENABLE
);

--create customer table
CREATE TABLE "CUSTOMER"(
       "CUSTOMER_ID" INTEGER,
       "FIRST_NAME" VARCHAR2(30) CONSTRAINT "CS_FSTNAME_NN" NOT NULL ENABLE,
       "LAST_NAME" VARCHAR2(30) CONSTRAINT "CS_LNAME_NN" NOT NULL ENABLE,
       "DATE_OF_BIRTH" DATE CONSTRAINT "CS_DATEBRTH_NN" NOT NULL ENABLE,
       "AGE" INTEGER CONSTRAINT "CS_AGE_NN" NOT NULL ENABLE,
       "PHONE" VARCHAR2(11) CONSTRAINT "CS_PHONE_NN" NOT NULL ENABLE,
       "CNP" VARCHAR2(13) CONSTRAINT "CS_CNP_NN" NOT NULL ENABLE,
       "LICENSE_PLATE" VARCHAR2(10) CONSTRAINT "CS_LICPLATE_NN" NOT NULL ENABLE,
        CONSTRAINT "CS_PHONE_UK" UNIQUE ("PHONE")
  USING INDEX ENABLE,
        CONSTRAINT "CS_CUSTOMERID_PK" PRIMARY KEY ("CUSTOMER_ID")
  USING INDEX ENABLE
);

--create had_accident table
CREATE TABLE "HAD_ACCIDENT" (
       "HAD_ACCIDENT_ID" INTEGER,
       "ACCIDENT_ID" INTEGER,
       "CUSTOMER_ID" INTEGER CONSTRAINT "HA_CUSID_NN" NOT NULL ENABLE,
       "IS_FAULT" VARCHAR2(30) CONSTRAINT "HA_ISFLT_NN" NOT NULL ENABLE,
        CONSTRAINT "HA_HADACC_PK" PRIMARY KEY ("HAD_ACCIDENT_ID","ACCIDENT_ID")
    USING INDEX ENABLE
)

--Add FK constraints
  ALTER TABLE "HAD_ACCIDENT" ADD CONSTRAINT "HA_CUSID_FK1" FOREIGN KEY ("CUSTOMER_ID")
        REFERENCES "CUSTOMER" ("CUSTOMER_ID") ENABLE;
  ALTER TABLE "HAD_ACCIDENT" ADD CONSTRAINT "HA_ACCID_FK2" FOREIGN KEY ("ACCIDENT_ID")
        REFERENCES "ACCIDENT" ("ACCIDENT_ID") ENABLE;
  CREATE INDEX "HA_CUSID_IX" ON "HAD_ACCIDENT" ("CUSTOMER_ID");

--create lives_in table
CREATE TABLE "LIVES_IN"(
       "LIVINGPLACE_ID" INTEGER,
       "CUSTOMER_ID" INTEGER,
       "ADD_ID" INTEGER,
        CONSTRAINT "LI_LIVESIN_PK" PRIMARY KEY("LIVINGPLACE_ID","CUSTOMER_ID","ADD_ID")
     USING INDEX ENABLE
);

--Add FK constraints
ALTER TABLE "LIVES IN" ADD CONSTRAINT "LI_CUSTOMERID_FK1" FOREIGN KEY ("CUSTOMER_ID")
       REFERENCES "CUSTOMER" ("CUSTOMER_ID") ENABLE;
ALTER TABLE "LIVES IN" ADD CONSTRAINT "LI_ADDID_FK2" FOREIGN KEY ("ADD_ID")
       REFECENCES "ADDRESS" ("ADD_ID") ENABLE;

--create method_of_payment table
CREATE TABLE "METHOD_OF_PAYMENT" (
	"METHOD_OF_PAY_ID" INTEGER,
	"METHOD" VARCHAR2(15) CONSTRAINT "MOP_MET_NN" NOT NULL ENABLE,
	CONSTRAINT "MOP_MOPID_PK" PRIMARY KEY ("METHOD_OF_PAY_ID")
USING INDEX ENABLE
);

--create payment table
CREATE TABLE "PAYMENT" (
	"PAY_ID" INTEGER,
	"NUMBER_OF_PAYMENTS" INTEGER CONSTRAINT "PM_NOP_NN" NOT NULL ENABLE,
	"AMOUNT" INTEGER CONSTRAINT "PM_AM_NN" NOT NULL ENABLE,
	"CURRENCY_ID" INTEGER CONSTRAINT "PM_CRID_NN" NOT NULL ENABLE,
	"METHOD_OF_PAY_ID" INTEGER CONSTRAINT "PM_MOPID_NN" NOT NULL ENABLE,
	CONSTRAINT "PM_PID_PK" PRIMARY KEY ("PAY_ID")
	USING INDEX ENABLE
);

--Add FK constraints
  ALTER TABLE "PAYMENT" ADD CONSTRAINT "PM_CRID_FK" FOREIGN KEY ("CURRENCY_ID")
	REFERENCES "CURRENCY" ("CURRENCY_ID") ENABLE;
  ALTER TABLE "PAYMENT" ADD CONSTRAINT "PM_MOPID_FK" FOREIGN KEY ("METHOD_OF_PAY_ID")
	REFERENCES "METHOD_OF_PAYMENT" ("METHOD_OF_PAY_ID") ENABLE;

--create policy table
CREATE TABLE "POLICY" (
	"POLICY_ID" INTEGER,
	"POLICY_NUM" VARCHAR2(10) CONSTRAINT "POL_POLNUM_NN" NOT NULL ENABLE,
	"TYPE" VARCHAR2(5) CONSTRAINT "POL_TYPE_NN" NOT NULL ENABLE,
	"COVERAGE" VARCHAR2(20) CONSTRAINT "POL_COV_NN" NOT NULL ENABLE,
	"TERM_PRICE" NUMBER(6,2) CONSTRAINT "POL_TP_NN" NOT NULL ENABLE,
	"DEDUCTIBLE" VARCHAR(5) CONSTRAINT "POL_DED_NN" NOT NULL ENABLE,
	"ISSUED_DATE" DATE CONSTRAINT "POL_ISSD_NN" NOT NULL ENABLE,
	"PP_ID" INTEGER CONSTRAINT "POL_PPID_NN" NOT NULL ENABLE,
	"AP_ID" INTEGER CONSTRAINT "POL_ADID_NN" NOT NULL ENABLE,
	CONSTRAINT "POL_POLID_PK" PRIMARY KEY ("POLICY_ID")
    USING INDEX ENABLE
);

--Add FK constraints
  ALTER TABLE "POLICY" ADD CONSTRAINT "POL_PPID_FK" FOREIGN KEY ("PP_ID")
            REFERENCES "PROPERTY_POLICY" ("PP_ID") ENABLE;
  ALTER TABLE "POLICY" ADD CONSTRAINT "POL_APID_FK" FOREIGN KEY ("AP_ID")
            REFERENCES "AUTO_POLICY" ("AP_ID") ENABLE;
  CREATE INDEX "POL_PPID_IX" ON "POLICY" ("PP_ID");
  CREATE INDEX "POL_APID_IX" ON "POLICY ("AP_ID");

--create policy_holder table
CREATE TABLE "POLICY_HOLDER"(
       "POLICYHOLDER_ID" INTEGER,
       "POLICY_ID" INTEGER,
       "CUSTOMER_ID" INTEGER,
        CONSTRAINT "PH_POLHOLD_PK" PRIMARY KEY ("POLICYHOLDER_ID","POLICY_ID","CUSTOMER_ID")
     USING INDEX ENABLE
);

--Add FK constraints
  ALTER TABLE "POLICY_HOLDER" ADD CONSTRAINT "PH_POLID_FK1" FOREIGN KEY ("POLICY_ID")
        REFERENCES "POLICY" ("POLICY_ID") ENABLE;
  ALTER TABLE "POLICY_HOLDER" ADD CONSTRAINT "PH_CUSID_FK2" FOREIGN KEY ("CUSTOMER_ID")
        REFERENCES "CUSTOMER" ("CUSTOMER_ID") ENABLE;

--create policy_payment table
CREATE TABLE "POLICY_PAYMENT"(
       "POLICYPAYMENT_ID" NUMBER(6,2),
       "PAY_ID" INTEGER,
       "POLICY_ID" INTEGER,
       "P_DATE" DATE CONSTRAINT "PP_PDATE_NN" NOT NULL ENABLE,
        CONSTRAINT "PP_POLPAY_PK" PRIMARY KEY ("POLICYPAYMENT_ID","PAY_ID","POLICY_ID")
      USING INDEX ENABLE
);

--Add FK coinstraints
  ALTER TABLE "POLICY_PAYMENT" ADD CONSTRAINT "PP_PAYID_FK1" FOREIGN KEY ("PAY_ID")
        REFERENCES "PAYMENT" ("PAY_ID") ENABLE;
  ALTER TABLE "POLICY_PAYMENT" ADD CONSTRAINT "PP_POLID_FK2" FOREIGN KEY ("POLICY_ID")
        REFERENCES "POLICY" ("POLICY_ID") ENABLE;

--create property table
CREATE TABLE "PROPERTY" (
	"PROPERTY_ID" INTEGER,
	"COST" NUMBER(6,2) CONSTRAINT "PPT_COST_NN" NOT NULL ENABLE,
	"TYPE" VARCHAR2(10) CONSTRAINT "PPT_TYPE_NN" NOT NULL ENABLE,
	CONSTRAINT "PPT_PPTID_PK" PRIMARY KEY ("PROPERTY_ID")
USING INDEX ENABLE
);

--create property_policy table
CREATE TABLE "PROPERTY_POLICY"(
	"PP_ID" INTEGER,
	"POLICY_ID" INTEGER,
	"NUM" INTEGER CONSTRAINT "PP_NUM_NN" NOT NULL ENABLE,
	CONSTRAINT "PP_PPID_PK" PRIMARY KEY ("PP_ID","POLICY_ID")
	USING INDEX ENABLE
);

--Add FK constraints
  ALTER TABLE "PROPERTY_POLICY" ADD CONSTRAINT "PP_POLID_FK1" FOREIGN KEY ("POLICY_ID")
	REFERENCES "POLICY" ("POLICY_ID") ENABLE;

--create was_in_accident table
CREATE TABLE "WAS_IN_ACCIDENT"(
	"WAS_IN_ACCIDENT_ID" INTEGER,
	"ACCIDENT_ID" INTEGER,
	"DAMAGE_COST" INTEGER,
	"CAR_ID" INTEGER CONSTRAINT "WIA_CARID_NN" NOT NULL ENABLE,
	CONSTRAINT "WIA_WASINACCIDENTID_PK" PRIMARY KEY ("WAS_IN_ACCIDENT_ID","ACCIDENT_ID")
	USING INDEX ENABLE
)

--Add FK constraints
  ALTER TABLE "WAS_IN_ACCIDENT" ADD CONSTRAINT "ACC_ACCID_FK1" FOREIGN KEY ("ACCIDENT_ID")
	REFERENCES "ACCIDENT" ("ACCIDENT_ID") ENABLE;
  ALTER TABLE "WAS_IN_ACCIDENT" ADD CONSTRAINT "C_CARID_FK2" FOREIGN KEY ("CAR_ID")
	REFERENCES "CAR" ("CAR_ID") ENABLE;
  CREATE INDEX "WIA_CARID_IX" ON "WAS_IN_ACCIDENT" ("CAR_ID");

--create workplace table
CREATE TABLE "WORKPLACE"(
     "WORKPLACE_ID" INTEGER,
     "AGENT_ID" INTEGER,
     "ADD_ID" INTEGER,
      CONSTRAINT "WKP_WORKPLACE_PK" PRIMARY KEY ("WORKPLACE_ID","AGENT_ID","ADD_ID")
   USING INDEX ENABLE
);

--Add FK constraints
ALTER TABLE "WORKPLACE" ADD CONSTRAINT "WKP_AGENTID_FK1" FOREIGN KEY ("AGENT_ID")
     REFERENCES "AGENT" ("AGENT_ID") ENABLE;
ALTER TABLE "WORKPLACE" ADD CONSTRAINT "WKP_ADDID_FK2" FOREIGN KEY ("ADD_ID")
     REFERENCES "ADDRESS" ("ADD_ID") ENABLE;
        
  
       







